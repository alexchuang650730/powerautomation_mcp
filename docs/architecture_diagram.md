# PowerAutomation MCP 架构设计

## 架构概述

PowerAutomation MCP (Manus Control Panel) 是一个用于自动化监控和控制Manus AI交互的工具集。该架构由多个核心模块组成，通过统一配置管理实现无缝集成。

## 架构模块关系图

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         PowerAutomation MCP 架构                         │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
                ┌─────────────────────────────────────────┐
                │         统一配置管理 (UnifiedConfig)     │
                └─────────────────────────────────────────┘
                                    │
                                    ├─────────────────────────┐
                                    │                         │
                                    ▼                         ▼
┌─────────────────────────────────────────────┐   ┌─────────────────────────────────┐
│              视觉监控系统                    │   │           CLI 工具系统          │
├─────────────────────────────────────────────┤   ├─────────────────────────────────┤
│ ┌─────────────────┐    ┌─────────────────┐  │   │ ┌─────────────┐ ┌─────────────┐ │
│ │  视觉校准工具   │    │  自动监控工具   │  │   │ │ 下载模块   │ │ 上传模块   │ │
│ │(VisualCalibrator)│◄──►│(AutoWebMonitor) │  │   │ │           │ │           │ │
│ └─────────────────┘    └─────────────────┘  │   │ └─────────────┘ └─────────────┘ │
│          │                      │           │   │          │            │         │
│          ▼                      ▼           │   │          ▼            ▼         │
│ ┌─────────────────┐    ┌─────────────────┐  │   │ ┌─────────────┐ ┌─────────────┐ │
│ │ 图形区域选择器  │    │  OCR文本识别    │  │   │ │ 测试模块   │ │ 工作流模块  │ │
│ │(GUIRegionSelector)│  │  (OCRProcessor)  │  │   │ │           │ │           │ │
│ └─────────────────┘    └─────────────────┘  │   │ └─────────────┘ └─────────────┘ │
└─────────────────────────────────────────────┘   └─────────────────────────────────┘
                                    │                         │
                                    ▼                         ▼
                ┌─────────────────────────────────────────────────────┐
                │                  问题解决系统                       │
                ├─────────────────────────────────────────────────────┤
                │ ┌─────────────────────┐    ┌─────────────────────┐  │
                │ │  Manus问题解决器    │    │  思考与操作记录器   │  │
                │ │ (ManusProblemSolver)│◄──►│(ThoughtActionRecorder)│ │
                │ └─────────────────────┘    └─────────────────────┘  │
                │                │                      │             │
                │                ▼                      ▼             │
                │ ┌─────────────────────┐    ┌─────────────────────┐  │
                │ │  MCP头脑风暴器      │    │  MCP规划器          │  │
                │ │  (MCPBrainstorm)    │◄──►│  (MCPPlanner)       │  │
                │ └─────────────────────┘    └─────────────────────┘  │
                └─────────────────────────────────────────────────────┘
                                    │
                                    ▼
                ┌─────────────────────────────────────────┐
                │         中央协调器 (MCPCentralCoordinator)│
                └─────────────────────────────────────────┘
```

## 核心模块说明

### 1. 统一配置管理 (UnifiedConfig)

- **功能**: 提供统一的配置管理，支持视觉校准工具和CLI功能的配置需求
- **关键组件**: 
  - 配置加载与保存
  - 默认配置管理
  - 配置项验证
  - 单例模式实现

### 2. 视觉监控系统

#### 2.1 视觉校准工具 (VisualCalibrator)

- **功能**: 校准和测试自动网页监控的视觉抓取区域
- **关键组件**:
  - 屏幕截图捕获
  - 浏览器窗口检测
  - 内容区域识别
  - 校准网格生成

#### 2.2 自动监控工具 (AutoWebMonitor)

- **功能**: 自动监控网页变化并记录
- **关键组件**:
  - 定时截图
  - 区域变化检测
  - 变化记录与通知

#### 2.3 图形区域选择器 (GUIRegionSelector)

- **功能**: 提供图形化界面进行区域选择
- **关键组件**:
  - 交互式区域选择
  - 坐标实时显示
  - 配置自动保存

#### 2.4 OCR文本识别 (OCRProcessor)

- **功能**: 从图像中提取文本内容
- **关键组件**:
  - 文本区域检测
  - 文字识别与提取
  - 结果格式化

### 3. CLI工具系统

#### 3.1 下载模块

- **功能**: 检查并下载GitHub仓库中的release版本
- **关键组件**:
  - GitHub API交互
  - 版本检查与比较
  - 文件下载与验证

#### 3.2 上传模块

- **功能**: 将本地更改上传到GitHub仓库
- **关键组件**:
  - Git操作封装
  - 提交信息管理
  - 冲突处理

#### 3.3 测试模块

- **功能**: 运行测试并收集问题
- **关键组件**:
  - 测试脚本执行
  - 结果分析
  - 问题收集

#### 3.4 工作流模块

- **功能**: 协调下载、测试、解决问题和上传等步骤
- **关键组件**:
  - 工作流定义
  - 步骤协调
  - 报告生成

### 4. 问题解决系统

#### 4.1 Manus问题解决器 (ManusProblemSolver)

- **功能**: 分析问题、提出修复策略和测试方案
- **关键组件**:
  - 问题分析
  - 修复策略生成
  - 测试方案制定
  - 版本回滚管理

#### 4.2 思考与操作记录器 (ThoughtActionRecorder)

- **功能**: 记录思考过程和操作步骤
- **关键组件**:
  - 思考记录
  - 操作记录
  - 日志管理

#### 4.3 MCP头脑风暴器 (MCPBrainstorm)

- **功能**: 分析MCP能力缺口并提升能力
- **关键组件**:
  - 能力覆盖分析
  - 能力缺口识别
  - 能力增强计划生成
  - 能力原型生成

#### 4.4 MCP规划器 (MCPPlanner)

- **功能**: 规划MCP执行步骤和策略
- **关键组件**:
  - 任务分解
  - 步骤规划
  - 执行监控

### 5. 中央协调器 (MCPCentralCoordinator)

- **功能**: 协调各个模块的工作，提供统一接口
- **关键组件**:
  - 模块初始化
  - 任务分发
  - 结果聚合
  - 异常处理

## 数据流

1. **配置流**: 所有模块通过UnifiedConfig获取配置
2. **视觉监控流**: VisualCalibrator → GUIRegionSelector → AutoWebMonitor → OCRProcessor
3. **CLI工作流**: 下载模块 → 测试模块 → 问题解决系统 → 上传模块
4. **问题解决流**: ManusProblemSolver → ThoughtActionRecorder → MCPBrainstorm → MCPPlanner

## 扩展性设计

架构设计考虑了以下扩展点:

1. **新监控类型**: 可通过扩展AutoWebMonitor添加新的监控类型
2. **新问题解决策略**: 可通过扩展ManusProblemSolver添加新的解决策略
3. **新CLI命令**: 可通过扩展CLI工具系统添加新的命令
4. **新配置项**: 可通过扩展UnifiedConfig支持新的配置项

## 版本管理

ManusProblemSolver模块实现了版本回滚功能，支持:

1. 创建版本保存点
2. 列出所有保存点
3. 回滚到指定保存点
4. 在持续出错时自动回滚到保存点

## 部署架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                            用户环境                                     │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         PowerAutomation MCP                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │ 视觉监控系统 │  │  CLI工具系统 │  │ 问题解决系统 │  │ 中央协调器  │     │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                            外部系统                                     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │  GitHub仓库  │  │  Manus.im   │  │   OCR引擎   │  │  通知系统   │     │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```
